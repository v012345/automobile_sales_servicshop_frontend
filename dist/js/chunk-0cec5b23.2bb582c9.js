(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0cec5b23"],{"041c":function(t,i,a){t.exports=a.p+"img/myCoupons.3eeca74d.jpg"},"1c76":function(t,i,a){"use strict";a("c6e5")},"1ce5":function(t,i,a){"use strict";a("cb6e")},5377:function(t,i,a){var e=a("83ab"),n=a("9bf2"),o=a("ad6d"),s=a("d039"),c=RegExp.prototype,r=e&&s((function(){return"sy"!==Object.getOwnPropertyDescriptor(c,"flags").get.call({dotAll:!0,sticky:!0})}));r&&n.f(c,"flags",{configurable:!0,get:o})},6285:function(t,i,a){t.exports=a.p+"img/share_button.6bef1d39.png"},"6d04":function(t,i,a){t.exports=a.p+"img/countdown.a1427068.png"},"7abe":function(t,i,a){"use strict";a.r(i);var e=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[t.activity.id?[t._e(),e("van-image",{attrs:{width:"100vw",fit:"cover",src:t.$backend+t.activity.poster}})]:t._e(),e("van-form",[e("van-field",{attrs:{label:"门店名称",readonly:"",placeholder:"门店名称"},model:{value:t.activity.shop,callback:function(i){t.$set(t.activity,"shop",i)},expression:"activity.shop"}}),e("van-field",{attrs:{clickable:"",label:"门店电话",readonly:"",placeholder:"门店电话","right-icon":"phone-o"},on:{click:function(i){return t.call(t.activity.tel)}},model:{value:t.activity.tel,callback:function(i){t.$set(t.activity,"tel",i)},expression:"activity.tel"}}),e("van-field",{attrs:{clickable:"",readonly:"",label:"门店地址",placeholder:"门店地址","right-icon":"location-o"},on:{click:function(i){return t.locate(t.activity.location)}},model:{value:t.activity.address,callback:function(i){t.$set(t.activity,"address",i)},expression:"activity.address"}})],1),e("h3",{ref:"sign_up_form"},[t._v("信息登记处")]),e("van-form",[t.activityConfig.show_license_plate_number_field?[e("van-field",{attrs:{required:"",label:"车牌号",placeholder:"车牌号"},model:{value:t.sign_up_form.licensePlateNumber,callback:function(i){t.$set(t.sign_up_form,"licensePlateNumber","string"===typeof i?i.trim():i)},expression:"sign_up_form.licensePlateNumber"}})]:t._e(),e("van-field",{attrs:{required:"",label:"手机号",placeholder:"手机号",type:"number"},model:{value:t.sign_up_form.phoneNumber,callback:function(i){t.$set(t.sign_up_form,"phoneNumber","string"===typeof i?i.trim():i)},expression:"sign_up_form.phoneNumber"}}),e("van-field",{attrs:{required:"",label:"姓名",placeholder:"姓名"},model:{value:t.sign_up_form.name,callback:function(i){t.$set(t.sign_up_form,"name","string"===typeof i?i.trim():i)},expression:"sign_up_form.name"}}),t.activityConfig.allow_user_inputing_car_model?[e("van-field",{attrs:{required:"",label:"车型",placeholder:"车型"},model:{value:t.sign_up_form.carModel,callback:function(i){t.$set(t.sign_up_form,"carModel","string"===typeof i?i.trim():i)},expression:"sign_up_form.carModel"}})]:[e("van-field",{attrs:{required:"",readonly:"",label:"车型",placeholder:"车型"},on:{click:function(i){t.showCarModelPicker=!0}},model:{value:t.sign_up_form.carModel,callback:function(i){t.$set(t.sign_up_form,"carModel","string"===typeof i?i.trim():i)},expression:"sign_up_form.carModel"}})]],2),e("div",{staticClass:"count-down"},[e("img",{attrs:{src:a("6d04")}}),e("div",{staticClass:"text"},["inProgress"==t.activity.state?[e("div",[t._v("报名参加活动")]),e("div",[t._v("活动倒计时")]),e("div",[e("van-count-down",{attrs:{time:t.countDown,format:"DD 天 HH时 mm分 ss秒"},on:{finish:t.activityEnds}})],1)]:[e("div",[t._v("活动已结束")]),e("div",[t._v("下一场活动马上开启")])]],2)]),e("div",{staticClass:"contract"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.checked,expression:"checked"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.checked)?t._i(t.checked,null)>-1:t.checked},on:{change:function(i){var a=t.checked,e=i.target,n=!!e.checked;if(Array.isArray(a)){var o=null,s=t._i(a,o);e.checked?s<0&&(t.checked=a.concat([o])):s>-1&&(t.checked=a.slice(0,s).concat(a.slice(s+1)))}else t.checked=n}}}),e("span",{staticStyle:{"font-size":"0.8rem"}},[t._v('请阅读相关"'),e("span",{staticStyle:{color:"darkblue"},on:{click:t.showContract}},[t._v("活动条款")]),t._v('"')])]),t.activity.id?[e("div",{staticClass:"van-hairline--bottom"},[t._v("已有"+t._s(t.activity.participants_count+t.activity.offset.participants)+"人关注 ")]),e("div",{staticClass:"participant-avatar"},t._l(Math.min(33,t.activity.participants.length),(function(i){return e("div",{key:i.id,staticClass:"avatar"},[e("van-image",{attrs:{round:"",fit:"cover",src:t.activity.participants[i-1].participant_info.avatar}})],1)})),0),e("div",{staticClass:"van-hairline--bottom"},[t._v("已参与"+t._s(t.activity.sales_number+t.activity.offset.coupons)+"人")]),e("div",[e("van-notice-bar",{staticStyle:{padding:"0",height:"60px"},attrs:{scrollable:!1}},[e("van-swipe",{staticClass:"notice-swipe",attrs:{vertical:"",autoplay:3e3,"show-indicators":!1}},t._l(Math.ceil(t.normalCoupons.coupons.length/2),(function(i){return e("van-swipe-item",{key:i},[e("div",{staticClass:"swipe-item"},t._l(2,(function(a){return e("div",{key:a,staticClass:"row"},[e("div",{staticClass:"avatar"},[e("van-image",{attrs:{height:"25px",width:"25px",fit:"cover",round:"",src:t.normalCoupons.coupons[(2*i-a%2-1)%t.normalCoupons.coupons.length].participant.participant_info.avatar},on:{click:function(e){t.log(t.normalCoupons.coupons[(2*i-a%2-1)%t.normalCoupons.coupons.length].participant)}}})],1),e("div",{staticClass:"name",staticStyle:{"margin-right":"0.5rem"}},[t._v(" "+t._s(t.normalCoupons.coupons[(2*i-a%2-1)%t.normalCoupons.coupons.length].participant.participant_info.name)+" ")]),t.activityConfig.show_license_plate_number_field&&t.normalCoupons.coupons[(2*i-a%2-1)%t.normalCoupons.coupons.length].participant.license_plate_number?e("div",{staticClass:"license_plate_number",staticStyle:{"margin-right":"0.5rem"}},[t._v(" "+t._s(t.normalCoupons.coupons[(2*i-a%2-1)%t.normalCoupons.coupons.length].participant.license_plate_number.replace(RegExp("^(...)(.*)(..)$"),"$1**$3"))+" ")]):t._e(),e("div",{staticStyle:{"margin-right":"0.5rem"}},[t._v(" "+t._s(t.normalCoupons.coupons[(2*i-a%2-1)%t.normalCoupons.coupons.length].created_at)+" ")]),e("div",[t._v(" 支付"+t._s(t.normalCoupons.coupons[(2*i-a%2-1)%t.normalCoupons.coupons.length].value)+"元 ")])])})),0)])})),1)],1)],1)]:t._e(),e("div",{staticClass:"coupon-buttons"},[e("div",{on:{click:t.toCouponsView}},[e("img",{attrs:{src:a("af1a")}})]),e("div",{on:{click:t.scan}},[e("img",{attrs:{src:a("041c")}})])]),t.activity.id?t._l(t.activity.propaganda_images,(function(i,a){return e("van-image",{key:a,attrs:{src:t.$backend+i}})})):t._e(),e("div",{staticStyle:{display:"flex","justify-content":"center"}},[e("img",{attrs:{width:"150px",height:"45px",src:a("cafc")},on:{click:t.franchise}})]),e("div",{staticClass:"footer"},[t._v(t._s(t.config.tech_surppot)+"提供技术支持")]),e("div",{staticClass:"share-button",on:{click:t.generatePoster}},[e("img",{attrs:{width:"50px",height:"50px",src:a("6285")}})]),e("div",{staticClass:"bottom-buttons"},[e("div",{staticClass:"introduction-button",on:{click:function(i){t.showIntroduction=!0}}},[e("p",[t._v("活动锦囊")])]),"ended"==t.activity.state?[t._m(0)]:[t.haveACoupon?t._e():[e("div",{staticClass:"sign-up-button",on:{click:t.buy}},[e("p",[t._v("马上参与("+t._s(t.activity.signing_up_fee)+"元)")])])],t.haveACoupon?[e("div",{staticClass:"sign-up-button"},[e("p",[t._v("已参与("+t._s(t.activity.signing_up_fee)+"元)")])])]:t._e()]],2),e("div",[e("van-popup",{style:{minHeight:"150vw",paddingTop:"3rem",boxSizing:"border-box"},attrs:{closeable:"",position:"top"},model:{value:t.showIntroduction,callback:function(i){t.showIntroduction=i},expression:"showIntroduction"}},[e("van-tabs",{attrs:{type:"card"}},[e("van-tab",{attrs:{title:"活动说明"}},[e("div",{staticClass:"activity-desc"},[e("h3",[t._v("参与记录")]),t.haveACoupon&&t.availableCoupons.length>0?e("div",[t._v(t._s(t.availableCoupons[0].created_at)+"参加活动")]):e("div",[t._v("未参加")])]),e("div",{staticClass:"activity-desc"},[e("h3",[t._v("活动时间")]),e("div",[t._v(t._s(t.activity.start_at)+" 至 "+t._s(t.activity.end_at))])]),e("div",{staticClass:"activity-desc"},[e("h3",[t._v("技术支持")]),e("div",[t._v("页面技术由"+t._s(t.config.tech_surppot)+"提供")])]),t.config.custom?t._l(t.config.custom,(function(i,a){return e("div",{key:a,staticClass:"activity-desc"},[e("h3",[t._v(t._s(i.department))]),e("div",[t._v(t._s(i.title))])])})):t._e()],2),e("van-tab",{attrs:{title:"我的奖品"}},t._l(t.availableCoupons,(function(i){return e("div",{key:i.id,on:{click:t.toCouponsView}},[e("Coupon",{attrs:{value:t.activityConfig.normal_coupon_value,allow_to_use_at:t.activity.allow_to_use_at,expire_at:t.activity.expire_at,description:t.activityConfig.normal_coupon_description,available:!0}})],1)})),0)],1)],1)],1),e("div",[e("van-popup",{attrs:{closeable:""},model:{value:t.poster.show,callback:function(i){t.$set(t.poster,"show",i)},expression:"poster.show"}},[e("div",{staticClass:"poster"},[e("van-image",{attrs:{width:"100%",src:t.poster.src}})],1)])],1),e("div",[e("van-popup",{attrs:{round:"",position:"bottom"},model:{value:t.showCarModelPicker,callback:function(i){t.showCarModelPicker=i},expression:"showCarModelPicker"}},[e("van-cascader",{attrs:{title:"选择车型",options:t.activityConfig.brand_category},on:{close:function(i){t.showCarModelPicker=!1},finish:t.onFinish},model:{value:t.cascaderValue,callback:function(i){t.cascaderValue=i},expression:"cascaderValue"}})],1)],1)],2)},n=[function(){var t=this,i=t.$createElement,a=t._self._c||i;return a("div",{staticClass:"sign-up-button"},[a("p",[t._v("活动已结束")])])}],o=a("1da1"),s=a("5530"),c=(a("96cf"),a("4de4"),a("d3b7"),a("fb6a"),a("a15b"),a("d81d"),a("b0c0"),a("5377"),a("99af"),a("ac1f"),a("466d"),a("4d63"),a("c607"),a("2c3e"),a("25f0"),a("2241")),r=a("d399"),l=a("f43e"),u=a("2f62"),p={name:"Home",data:function(){return{checked:!1,flags:{},showCarModelPicker:!1,cascaderValue:"",showIntroduction:!1,isPaying:!1,poster:{show:!1,src:""},sign_up_form:{licensePlateNumber:"",phoneNumber:"",name:"",carModel:""}}},components:{Coupon:l["a"]},watch:{},computed:Object(s["a"])(Object(s["a"])({},Object(u["b"])(["activity","user","config","inviter","activityConfig"])),{},{haveACoupon:function(){var t=this;if(this.user.id&&this.activity.id){var i=this.user.coupons.filter((function(i){return i.activity_id==t.activity.id&&"normal"==i.type}));if(i.length>0)return!0}return!1},countDown:function(){return this.activity.end_at?this.$dayjs().isBefore(this.activity.end_at)?Math.abs(this.$dayjs().diff(this.activity.end_at,"millisecond")):0:864e5},availableCoupons:function(){var t=this;return this.user.id&&this.activity.id?this.user.coupons.filter((function(i){return i.activity_id==t.activity.id&&t.$dayjs().isBefore(t.activity.expire_at)&&"normal"==i.type})):[]},normalCoupons:function(){if(this.activity.id){var t=this.activity.coupons.filter((function(t){return"normal"==t.type}));return t.reverse(),{total:t.length,coupons:t.slice(0,50)}}return{total:0,coupons:[]}}}),methods:{showContract:function(){c["a"].alert({title:"用户购买须知",message:'1.机油仅限店内使用,机油升级或者超过4升,需要补差价<br>2.本活动不得与店内其他优惠同时使用<br>3.销售套餐由合作4S店提供,并由该店提供正规专业的保养服务<br>4.为回馈广大车主,套餐为特价福利产品,购买后不可退款<br><br>购买前请认真阅读本"须知",如有异议请咨询详情页面4S店服务电话',messageAlign:"left"}).then((function(){}))},log:function(t){console.log(t)},onFinish:function(t){var i=t.selectedOptions;this.showCarModelPicker=!1,this.sign_up_form.carModel=i.map((function(t){return t.text})).join("/")},toCouponsView:function(){this.$router.push("/coupons")},franchise:function(){this.$router.push("/franchise")},locate:function(t){this.$wx.openLocation(Object(s["a"])(Object(s["a"])({},t),{},{scale:17}))},call:function(t){window.location.href="tel://"+t},buy:function(){var t=this;return this.user.id&&this.activity.id&&this.activityConfig.activity_id?this.sign_up_form.phoneNumber&&this.sign_up_form.name&&this.sign_up_form.carModel?this.activityConfig.show_license_plate_number_field&&this.sign_up_form.licensePlateNumber.length<5?(Object(r["a"])({message:"请登记完整信息"}),void this.$refs.sign_up_form.scrollIntoView({behavior:"smooth"})):void(this.checked?(r["a"].loading({message:"请求支付中",forbidClick:!0,duration:0}),this.isPaying?Object(r["a"])({message:"正在购买,请稍等"}):(this.isPaying=!0,this.axios.post(this.$api+"v3/pay",Object(s["a"])({amount:this.activity.signing_up_fee,payer:this.user.id,open_id:this.user.open_id,activityId:this.activity.id,inviter:this.inviter,hostname:window.location.origin},this.sign_up_form)).then((function(i){t.isPaying=!1,console.log(i.data),t.$wx.chooseWXPay(Object(s["a"])(Object(s["a"])({},i.data),{},{timestamp:i.data.timeStamp,success:function(){t.flags.hasBought||(t.isPaying=!0,r["a"].loading({message:"正在取回优惠券,请稍等",forbidClick:!0,duration:0}))},cancel:function(){t.isPaying=!1,Object(r["a"])({message:"已取消支付"})}}))})).catch((function(i){t.isPaying=!1,500==i.response.status?Object(r["a"])({message:"请在微信内置浏览器中购买"}):400==i.response.status&&Object(r["a"])({message:"邀请好友购买后,您可以购买"})})))):Object(r["a"])({message:"请先阅读并相意活动条款"})):(Object(r["a"])({message:"请登记完整信息"}),void this.$refs.sign_up_form.scrollIntoView({behavior:"smooth"})):(Object(r["a"])({message:"正加在载个人信息,请稍等"}),void this.$refs.sign_up_form.scrollIntoView({behavior:"smooth"}))},activityEnds:function(){this.activity.state="ended"},scan:function(){var t=this;"employee"==this.user.permission?this.$wx.scanQRCode({needResult:1,success:function(i){t.axios.put(t.$api+"coupon/".concat(i.resultStr,"/use"),{temporaryId:localStorage.temporaryId}).then((function(t){203!=t.status?Object(r["a"])({message:"核销成功"}):c["a"].alert({title:"已核销",message:"请勿重复核销"})})).catch((function(){Object(r["a"])({message:"无核销权限"})}))}}):Object(r["a"])({message:"请找工作人员进行核销"})},generatePoster:function(){var t=this;this.poster.src?this.poster.show=!0:this.user.id&&this.activity.id&&(r["a"].loading({message:"正在为您生成海报",forbidClick:!0,duration:0}),this.axios.post(this.$api+"v3/activity/".concat(this.activity.id,"/participant/").concat(this.user.id,"/poster"),{content:window.location.origin+"/activity/".concat(this.activity.id,"/inviter/").concat(this.user.id),image:this.$qrcode.getQrBase64(window.location.origin+"/activity/".concat(this.activity.id,"/inviter/").concat(this.user.id),{width:150,height:150})}).then((function(i){r["a"].clear(),t.poster.src=i.data,t.poster.show=!0})))}},created:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function i(){var a,e;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,a=window.location.href.match(RegExp("(/activity/)([0-9]+)")),a&&(localStorage.activityId=a[a.length-1]),i.next=5,t.axios.post(t.$api+"v3/activity/configration",{activityId:localStorage.activityId});case 5:e=i.sent,t.$store.dispatch("setActivityConfig",e.data),console.log("activity config",e.data),localStorage.activityId=e.data.activity_id,t.sign_up_form.licensePlateNumber=e.data.license_plate_number_prefix,i.next=15;break;case 12:i.prev=12,i.t0=i["catch"](0),console.log("no activity config");case 15:case"end":return i.stop()}}),i,null,[[0,12]])})))()},mounted:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:t.$Echo.channel("4s").listen("Paid",(function(i){i.user_id==t.user.id&&(t.$set(t.flags,"hasBought",!0),t.axios.post(t.$api+"v3/init",{activityId:localStorage.activityId,temporaryId:localStorage.temporaryId}).then((function(i){r["a"].clear(),t.$store.dispatch("init",i.data),t.$router.push("/coupons")})))}));case 1:case"end":return i.stop()}}),i)})))()}},d=p,v=(a("1ce5"),a("2877")),f=Object(v["a"])(d,e,n,!1,null,"9a18d9f6",null);i["default"]=f.exports},a15b:function(t,i,a){"use strict";var e=a("23e7"),n=a("e330"),o=a("44ad"),s=a("fc6a"),c=a("a640"),r=n([].join),l=o!=Object,u=c("join",",");e({target:"Array",proto:!0,forced:l||!u},{join:function(t){return r(s(this),void 0===t?",":t)}})},af1a:function(t,i,a){t.exports=a.p+"img/useCoupons.45918790.jpg"},c6e5:function(t,i,a){},cafc:function(t,i,a){t.exports=a.p+"img/apply_button.b68c5257.png"},cb6e:function(t,i,a){},d81d:function(t,i,a){"use strict";var e=a("23e7"),n=a("b727").map,o=a("1dde"),s=o("map");e({target:"Array",proto:!0,forced:!s},{map:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}})},f43e:function(t,i,a){"use strict";var e=function(){var t=this,i=t.$createElement,a=t._self._c||i;return a("div",{staticClass:"van-coupon",class:{"van-coupon--disabled":!t.available},staticStyle:{"margin-top":"1rem"}},[a("div",{staticClass:"van-coupon__content"},[a("div",{staticClass:"van-coupon__head"},["normal"==t.type?[a("h2",{staticClass:"van-coupon__amount"},[t._v(t._s(t.value)),a("span",[t._v("元")])])]:[a("h2",{staticClass:"van-coupon__amount"},[a("span",{staticStyle:{"font-size":"1.5rem"}},[t._v(t._s(t.gift))])])],a("p",{staticClass:"van-coupon__condition"},[t._v("请到门店使用")])],2),a("div",{staticClass:"van-coupon__body"},[a("p",{staticClass:"van-coupon__name"},[t._v(t._s("normal"==t.type?"保养服务":"礼品券"))]),a("p",{staticClass:"van-coupon__valid"},[t._v(" "+t._s(t.$dayjs(t.allow_to_use_at).format("YYYY-MM-DD"))+" 至 "+t._s(t.$dayjs(t.expire_at).format("YYYY-MM-DD"))+" ")])]),a("div",{staticClass:"right_button"},[t.available?[a("van-button",{attrs:{type:"danger"}},[a("span",{staticClass:"text1"},[t._v("已生效")])])]:[a("van-button",{attrs:{color:"#cfcfcf",disabled:""}},[a("span",{staticClass:"text1"},[t._v("未生效")])])]],2)]),a("p",{staticClass:"van-coupon__description"},[t._v(t._s(t.description))])])},n=[],o={name:"Coupon",data:function(){return{gift:"收纳箱"}},props:{value:{},allow_to_use_at:{},expire_at:{},available:{},description:{},type:{default:"normal"}}},s=o,c=(a("1c76"),a("2877")),r=Object(c["a"])(s,e,n,!1,null,"a1086524",null);i["a"]=r.exports},fb6a:function(t,i,a){"use strict";var e=a("23e7"),n=a("da84"),o=a("e8b5"),s=a("68ee"),c=a("861d"),r=a("23cb"),l=a("07fa"),u=a("fc6a"),p=a("8418"),d=a("b622"),v=a("1dde"),f=a("f36a"),h=v("slice"),_=d("species"),m=n.Array,g=Math.max;e({target:"Array",proto:!0,forced:!h},{slice:function(t,i){var a,e,n,d=u(this),v=l(d),h=r(t,v),y=r(void 0===i?v:i,v);if(o(d)&&(a=d.constructor,s(a)&&(a===m||o(a.prototype))?a=void 0:c(a)&&(a=a[_],null===a&&(a=void 0)),a===m||void 0===a))return f(d,h,y);for(e=new(void 0===a?m:a)(g(y-h,0)),n=0;h<y;h++,n++)h in d&&p(e,n,d[h]);return e.length=n,e}})}}]);
//# sourceMappingURL=chunk-0cec5b23.2bb582c9.js.map