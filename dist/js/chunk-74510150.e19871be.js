(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-74510150"],{"759c":function(t,i,a){},a29e:function(t,i,a){"use strict";a.r(i);var o=function(){var t=this,i=t.$createElement,a=t._self._c||i;return a("div",[t.user.id&&t.activity.id&&t.activityConfig.activity_id?a("div",{staticClass:"card-container"},[a("van-tabs",{attrs:{type:"card"}},[a("van-tab",{attrs:{title:"可用的",name:"available"}},[t._l(t.availableCoupons,(function(i){return a("div",{key:i.id,on:{click:function(a){return t.dealWithTheCoupon(i)}}},[a("Coupon",{attrs:{value:t.activityConfig.normal_coupon_value,allow_to_use_at:t.activity.allow_to_use_at,expire_at:t.activity.expire_at,description:t.activityConfig.normal_coupon_description,available:"available"==i.state}})],1)})),t._l(t.sharedCoupons,(function(i){return a("div",{key:i.id,on:{click:function(a){return t.dealWithTheCoupon(i)}}},[a("Coupon",{attrs:{value:t.activityConfig.shared_coupon_value,allow_to_use_at:t.activity.allow_to_use_at,expire_at:t.activity.expire_at,description:t.activityConfig.shared_coupon_description,available:"available"==i.state}})],1)}))],2),a("van-tab",{attrs:{title:"失效的",name:"expired"}},t._l(t.expiredCoupons,(function(i){return a("div",{key:i.id},["normal"==i.type?[a("Coupon",{attrs:{value:t.activityConfig.normal_coupon_value,allow_to_use_at:t.activity.allow_to_use_at,expire_at:t.activity.expire_at,description:t.activityConfig.normal_coupon_description,available:!1}})]:[a("Coupon",{attrs:{value:t.activityConfig.shared_coupon_value,allow_to_use_at:t.activity.allow_to_use_at,expire_at:t.activity.expire_at,description:t.activityConfig.shared_coupon_description,available:!1}})]],2)})),0)],1)],1):t._e(),a("div",[a("van-popup",{model:{value:t.showQrcode,callback:function(i){t.showQrcode=i},expression:"showQrcode"}},[a("van-image",{attrs:{src:t.qrcode}})],1)],1),a("div",[a("van-popup",{model:{value:t.showOfficialAccountQrcode,callback:function(i){t.showOfficialAccountQrcode=i},expression:"showOfficialAccountQrcode"}},[a("van-image",{attrs:{src:"http://cdn4s.100pq.cn/official_account_qrcode.jpg"}})],1)],1),a("div",{staticClass:"footer-nav"},[a("van-button",{attrs:{type:"info",block:""},on:{click:t.back}},[t._v("返回首页 "),a("br"),a("span",{staticClass:"sales_number"},[t._v("已有人"+t._s(t.activity.sales_number)+"参与")])]),a("div",{staticClass:"middle-button"},[a("van-button",{attrs:{type:"danger",size:"large",block:""},on:{click:function(i){t.showOfficialAccountQrcode=!0}}},[a("span",{domProps:{innerHTML:t._s(t.activityConfig.my_coupon_middle_button)}})])],1),a("van-button",{attrs:{type:"info",block:""},on:{click:t.generatePoster}},[a("span",{domProps:{innerHTML:t._s(t.activityConfig.my_coupon_right_button)}})])],1)])},e=[],n=a("5530"),s=(a("4de4"),a("d3b7"),a("25f0"),a("99af"),a("d399")),c=a("f43e"),r=a("2f62"),u={name:"Coupons",data:function(){return{qrcode:"",showQrcode:!1,showOfficialAccountQrcode:!1}},components:{Coupon:c["a"]},computed:Object(n["a"])(Object(n["a"])({},Object(r["b"])(["activity","user","config","activityConfig","myPoster"])),{},{availableCoupons:function(){var t=this;return this.user.id&&this.activity.id?this.user.coupons.filter((function(i){return i.activity_id==t.activity.id&&t.$dayjs().isBefore(t.activity.expire_at)&&"normal"==i.type})):[]},sharedCoupons:function(){var t=this;return this.user.id&&this.activity.id?this.user.coupons.filter((function(i){return i.activity_id==t.activity.id&&t.$dayjs().isBefore(t.activity.expire_at)&&"shared"==i.type})):[]},expiredCoupons:function(){var t=this;return this.user.id&&this.activity.id?this.user.coupons.filter((function(i){return i.activity_id==t.activity.id&&!t.$dayjs().isBefore(t.activity.expire_at)})):[]}}),methods:{back:function(){window.history.length<=1?this.activity.id?this.$router.push("activity/".concat(this.activity.id)):this.$router.push("/"):this.$router.back()},dealWithTheCoupon:function(t){if("available"==t.state)return this.qrcode=this.$qrcode.getQrBase64(t.id.toString()),void(this.showQrcode=!0);"unactivated"!=t.state?Object(s["a"])({message:"此券已经核销"}):Object(s["a"])({message:"此券还没有激活,邀请好友后激活"})},generatePoster:function(){var t=this;this.myPoster&&this.myPoster.activity_id==this.activity.id?this.$router.push("/poster"):this.user.id&&this.activity.id&&(s["a"].loading({message:"正在为您生成海报",forbidClick:!0,duration:0}),this.axios.post(this.$api+"v3/activity/".concat(this.activity.id,"/participant/").concat(this.user.id,"/poster"),{content:window.location.origin+"/activity/".concat(this.activity.id,"/inviter/").concat(this.user.id),image:this.$qrcode.getQrBase64(window.location.origin+"/activity/".concat(this.activity.id,"/inviter/").concat(this.user.id),{width:150,height:150})}).then((function(i){s["a"].clear(),t.$store.dispatch("setMyPoster",{activity_id:t.activity.id,src:i.data}),t.$router.push("/poster")})))}},created:function(){var t=this;this.$Echo.channel("4s").listen("Used",(function(i){i.user_id==t.user.id&&t.axios.post(t.$api+"v3/init",{activityId:localStorage.activityId,temporaryId:localStorage.temporaryId}).then((function(i){t.showQrcode=!1,t.$store.dispatch("init",i.data)}))}))}},d=u,l=(a("d337"),a("2877")),v=Object(l["a"])(d,o,e,!1,null,"1f803b1c",null);i["default"]=v.exports},d337:function(t,i,a){"use strict";a("759c")},f43e:function(t,i,a){"use strict";var o=function(){var t=this,i=t.$createElement,a=t._self._c||i;return a("div",{staticClass:"van-coupon",class:{"van-coupon--disabled":!t.available},staticStyle:{"margin-top":"1rem"}},[a("div",{staticClass:"van-coupon__content"},[a("div",{staticClass:"van-coupon__head"},[a("h2",{staticClass:"van-coupon__amount"},[t._v(t._s(t.value)),a("span",[t._v("元")])]),a("p",{staticClass:"van-coupon__condition"},[t._v("无使用门槛")])]),a("div",{staticClass:"van-coupon__body"},[a("p",{staticClass:"van-coupon__name"},[t._v("优惠券")]),a("p",{staticClass:"van-coupon__valid"},[t._v(" "+t._s(t.$dayjs(t.allow_to_use_at).format("YYYY-MM-DD"))+" 至 "+t._s(t.$dayjs(t.expire_at).format("YYYY-MM-DD"))+" ")])])]),a("p",{staticClass:"van-coupon__description"},[t._v(t._s(t.description))])])},e=[],n={name:"Coupon",props:["value","allow_to_use_at","expire_at","available","description"]},s=n,c=a("2877"),r=Object(c["a"])(s,o,e,!1,null,null,null);i["a"]=r.exports}}]);
//# sourceMappingURL=chunk-74510150.e19871be.js.map